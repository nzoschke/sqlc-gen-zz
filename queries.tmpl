// Code generated by "sqlc-gen-zz". DO NOT EDIT.

package {{.Settings.Codegen.Out}}

import (
	"database/sql"

	"zombiezen.com/go/sqlite"
)

{{range .Queries}}
type {{.Name}}In struct {
  {{- range .Params}}
    {{camel .Column.Name}} {{gotype .Column.Type.Name}} `json:"{{.Column.Name}}"`
  {{- end}}
}

{{if eq .Cmd ":exec"}}
{{template "exec.tmpl" .}}
{{else if eq .Cmd ":one"}}
type {{.Name}}Out struct {
  {{- range .Columns}}
    {{camel .Name}} {{gotype .Type.Name}} `json:"{{.Name}}"`
  {{- end}}
}

func {{.Name}}(tx *sqlite.Conn, in {{.Name}}In) (*{{.Name}}Out, error) {
  stmt := tx.Prep(`{{.Text}}`)
  defer stmt.Reset()

  {{range .Params}}
	stmt.Bind{{dbtype .Column.Type.Name}}({{.Number}}, in.{{camel .Column.Name}})
  {{- end}}

  ok, err := stmt.Step()
  if err != nil {
    return nil, err
  }
  if !ok {
    return nil, sql.ErrNoRows
  }

	out := {{.Name}}Out{}
  {{- range $number, $col := .Columns}}
  {{- if eq (lower .Type.Name) "blob"}}
  out.{{camel .Name}} = []byte(stmt.ColumnText({{$number}}))
  {{- else if eq (lower .Type.Name) "any"}}
  out.{{camel .Name}} = []byte(stmt.ColumnText({{$number}}))
  {{- else}}
  out.{{camel .Name}} = stmt.Column{{dbtype .Type.Name}}({{$number}})
  {{- end}}
  {{- end}}

  return &out, nil
}
{{else if eq .Cmd ":many"}}
type {{.Name}}Out []{{.Name}}Row

type {{.Name}}Row struct {
  {{- range .Columns}}
    {{camel .Name}} {{gotype .Type.Name}} `json:"{{.Name}}"`
  {{- end}}
}

func {{.Name}}(tx *sqlite.Conn, in {{.Name}}In) ({{.Name}}Out, error) {
  stmt := tx.Prep(`{{.Text}}`)
  defer stmt.Reset()

  {{range .Params}}
	stmt.Bind{{dbtype .Column.Type.Name}}({{.Number}}, in.{{camel .Column.Name}})
  {{- end}}

	out := {{.Name}}Out{}
  for {
    ok, err := stmt.Step()
    if err != nil {
      return nil, err
    }
    if !ok {
      break
    }

    row := {{.Name}}Row{}
    {{- range $number, $col := .Columns}}
    {{- if eq (lower .Type.Name) "blob"}}
    row.{{camel .Name}} = []byte(stmt.ColumnText({{$number}}))
    {{- else}}
    row.{{camel .Name}} = stmt.Column{{dbtype .Type.Name}}({{$number}})
    {{- end}}
    {{- end}}

    out = append(out, row)
  }

  return out, nil
}

{{end}}
{{end}}